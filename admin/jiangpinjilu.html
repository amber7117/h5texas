<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>管理后台</title>
<link rel="stylesheet" href="/layui/css/layui.css">
<link rel="stylesheet" href="/layui/lay/modules/webuploader.css">
<style>


.layui-input, .layui-textarea{width:80%;}
@media screen and (max-width: 450px){
.layui-form-item .layui-input-inline{margin-left:5px;}

}

.layui-form{padding-top:10px;}


</style>

</head>
<body>
<div class="layui-layout layui-layout-admin">

    <div id="view" style="padding:20px;"> 
    
        <p style="padding:10px 20px;"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop" style="color:red;">&#xe63d;</i> 加载中...</p>
    </div>

    <script id="select" type="text/html">
    <table class="layui-table" >

	<tr>

        <td colspan="10"> 
        <div class="layui-form-item">
        <form class="layui-form" onsubmit="return sousuo();">

			<div class="layui-input-inline"  style="width:188px;">
                <select name="SOl" id="SOl">
                    <option value="-1" selected="selected">选择全部</option>

                    {{# layui.each(OFF, function(index, item){ }}
                         <option value="{{ index }}" {{ SOl == index ?' selected="selected" ':''}} >{{ item }}</option>
                    {{# }); }}

                </select>
            </div>
            
            <div class="layui-input-inline" style="width:188px;">
                <input type="text" name="SOID" value="{{ SOID }}" id="SOID" placeholder="用户uid" autocomplete="off"  class="layui-input">
            </div> 
           
            <button class="layui-btn layui-btn-normal" ><i class="layui-icon">&#xe615;</i> 立即搜索</button>
            </form>
         </div>
        </td>
     
     </tr>
	
      <colgroup>

       {{# if( $(window).width() > 700){ }}

        <col>
        <col>
        <col>
        {{# } }}
        <col>
        <col>
      </colgroup>
    <thead>
        <tr>
        {{# if( $(window).width() > 700){ }}
            <th>ID</th>
        {{# } }}
            <th>收货人</th>

        {{# if( $(window).width() > 700){ }}
            <th>状态</th>
        {{# } }}
        
            <th>操作</th>
        </tr>
        
    </thead>
    <tbody>
    {{#  layui.each(d, function(index, item){ }}
  
    <tr id="tb{{ item.id }}">

        {{# if( $(window).width() > 700){ }}

            <td>{{ item.id }}</td>

        {{# } }}

        <td>{{ item.xingming }}</td>

        {{# if( $(window).width() > 700){ }}

  
            <td><span class="">{{item.jiangid }}</span> _ <span class="off{{ item.off }}">{{ OFF[item.off] }}</span> </td>

        {{# } }}


    
        <td>
            <button class="layui-btn" onclick="edit({{ item.id }});"><i class="layui-icon">&#xe642;</i> 编辑</button>
            <button class="layui-btn layui-btn-danger  layui-btn-small" onclick="dbdel({{ item.id }});"><i class="layui-icon">&#xe640;</i> 删除</button>

        </td>

    </tr>
    {{# }); }}
  
  </tbody>
</table>


    


    </script>
    <div class="baoqi" style="padding:0px 20px;">

        <button class="layui-btn layui-btn-normal  layui-btn-small" onclick="add();" style="float:left;margin-right:18px;margin-top:10px;"><i class="layui-icon">&#xe654;</i> 新建 </button>
        
        
        <div id="page" style="float:left;"></div>

    </div>

</div>

</body>
</html>
<script src="/layui/layui.js"></script>
<script src="/layui/lay/modules/jquery-3.2.1.min.js"></script>
<script src="/layui/lay/modules/webuploader.js"></script>
<script>
var NUM = 10;
var pg = 1;
var quanxin = Array();
var ID = 0;
var OFF;
var gameid;
var level;
var BIZHONG;
var MODE = 'jiangpinjilu';
var huodongtype;

var SOl = -1;

var SOID = '';

var KOUFANG;
layui.config({
  base: '/layui/lay/modules/'
});


function sousuo(){

 
    SOID  = $("#SOID").val();
	SOl  = $("#SOl").val();
   
    pg =1;



    dbselect();
    return false;




}


function dbdel(ID){

    /*删除数据*/

    layer.confirm('确定删除?', {icon: 3, title:'提示'}, function(index){

        $.ajax({

            url:TXIN,
            type: "POST",
            data:{y:MODE,d:"delete",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")},
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){

                    $("#tb"+ID).remove();
                    layer.close(index);
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }
        });

    });
}

function edit(ID){

 
    html ='<form name="form" id="form" class="layui-form">';
    


    $.ajax({

            url:TXIN,
            type: "POST",
            data:{y:MODE,d:"get",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")},
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){

                    D = data.data;



                    
                    BIAO = Array(
                       'uid#用户UID#text##用户UID##required',
		'jiangid#奖品id#text##奖品id##',
		'jpname#奖品名字#text##奖品名字##',
		'jptupian#奖品图片#updateshow##奖品图片##',

		'bizhong#兑换道具#select##BIZHONG',
	    'jine#兑换数量#text##数量##',
		'xingming#收货人姓名#text##收货人姓名##',
		'dianhua#收货人电话#text##收货人电话##',
		'dizhi#收货人地址#text##收货人地址##',
		'ip#兑换人ip#text##兑换人ip##',
		'kuainame#快递类型#text##快递类型##',
		'kuaihaoma#快递号码#text##快递号码##',
		'beizhu#备注#text##备注##',
        'xtbeizhu#系统记录#textarea##系统记录##',

		'ctime#时间#text##',

		
		'off#状态#select##OFF',

	    'atime#时间#text##',


                        'tijiao##tjcz###立即修改#tijiao'
                    );

                    for(var z in BIAO){


                        html+=jsfrom(BIAO[z]);
                    
                    }

                    html+="</form>";

                        OPID = layer.open({
                        type: 1,
                        title:false,
                        area: ['100%', '100%'],
                        fixed: true, 
                        maxmin: false,
                        content: html
                        });

                    for(var H in D){


						if(H =='jptupian' ){

							

							
							$("#img"+H).attr({"src":D[H]});
						
						
						
						}


						if(H =='atime' ){

							$("[name="+H+"]").val( time(D[H]) );


							
                    
                    
						}else{

							$("[name="+H+"]").val(D[H]);
						}

                    
                    }


                    form = layui.form();
                    form.render();
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });



    form = layui.form();
    form.on('submit(tijiao)', function(data){
     
       

        dd = {y:MODE,d:"put",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")};
        obj = $.extend(dd,data.field);


        console.log(obj);

        $.ajax({

            url:TXIN,
            type: "POST",
            data:obj,
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){
                    layer.close(OPID);
                    dbselect();
                }


            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });

        return false;
    });
    form.render();


}



     
        

   

function add(ID){

    html ='<form name="form" id="form" class="layui-form">';



    BIAO = Array(
	   
		'uid#用户UID#text##用户UID##required',
		'jiangid#奖品id#text##奖品id##',
		'jpname#奖品名字#text##奖品名字##',
		'jptupian#奖品图片#updateshow##奖品图片##',

		'bizhong#奖励币种#select##BIZHONG',
	    'jine#奖励金额#text##金额##',
		'xingming#收货人姓名#text##收货人姓名##',
		'dianhua#收货人电话#text##收货人电话##',
		'dizhi#收货人地址#text##收货人地址##',
		'ip#兑换人ip#text##兑换人ip##',
		'kuainame#快递类型#text##快递类型##',
		'kuaihaoma#快递号码#text##快递号码##',
		'beizhu#备注#text##备注##',
        'xtbeizhu#系统记录#textarea##系统记录##',

		'ctime#时间#text##',

		
		'off#状态#select##OFF',

	    'atime#时间#text##',

		'tijiao##tjcz###立即添加#tijiao'
	);

        


    for(var z in BIAO){

        html+=jsfrom(BIAO[z]);
    
    }

    html+="</form>";

    OPID = layer.open({
            type: 1,
            title:false,
            area: ['100%', '100%'],
            fixed: true, 
            maxmin: false,
            content: html
    });


    form = layui.form();


    form.on('submit(tijiao)', function(data){


        dd = {y:MODE,d:"post",ttoken:TOKEN,apptoken:getCookie("apptoken")};
        obj = $.extend(dd,data.field);

        $.ajax({

            url:TXIN,
            type: "POST",
            data:obj,
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){
                    layer.close(OPID);
                    dbselect();

                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });

        return false;
    });

    form.render();
}



function vwselect(data){

    laytpl = layui.laytpl;
    element = layui.element();
   

    var tpl = document.getElementById('select').innerHTML;

    var render = laytpl(tpl).render(data);
    document.getElementById('view').innerHTML = render;
    element.init();

	form = layui.form();
  
    form.render('select');
 
}


function dbselect(){

    $(".baoqi").show();

    $.ajax({

        url:TXIN,
        type: "POST",
        data:{y:MODE,d:"get",num:NUM,pg:pg,uid:SOID,off:SOl,apptoken:getCookie("apptoken")},
        dataType: "json",
        timeout:"3000",
        success: function(data){

            if(data.token && data.token != ""){
            
                TOKEN = data.token;
            }

            D = data.data;

			if(D.OFF){

				OFF = D.OFF;
			}

			if(D.jine){

				BIZHONG = D.jine;
			}


			


            if(data.code == 1){

                layer.closeAll();
                vwselect(D.list);

            }else{

                layer.msg('没有更多数据');
            }


        },error:function(XMLHttpRequest){

            ajaxfan(XMLHttpRequest);
        }

    });

    



}



layui.use(['jquery','laytpl','laypage','layer','form', 'element','laydate'], function(){


    var layer = layui.layer,
 
    laydate =layui.laydate,
    upload =layui.upload,
    form = layui.form();
    $ = layui.jquery;
    var laytpl = layui.laytpl;
    var laypage = layui.laypage;

  
    dbselect();
    laypage({
    cont: 'page'
  
    ,pages: 10000000
    ,skip: false
    ,jump: function(obj, first){
            if(!first){

                pg = obj.curr;
                dbselect();
            }
           
        }
    });


});

</script>



