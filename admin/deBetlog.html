<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>管理后台</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/layui/lay/modules/webuploader.css">
    <style>
        .layui-form{padding-top:10px;}
        .qishu0{background-color: rgba(71, 253, 21, 0.13)}
        .qishu1{background-color: rgba(253, 12, 14, 0.11)}
        .qishu2{background-color: rgba(19, 10, 255, 0.1)
        }
        .qishu3{background-color: rgba(249, 255, 244, 0)
        }
        .qishu4{background-color: rgba(243, 51, 51, 0.22)
        }
        .qishu5{background-color: rgba(0, 150, 136, 0.11)
        }
        .qishu6{background-color: rgba(165, 165, 165, 0.17)
        }
        .qishu7{background-color: rgba(14, 11, 255, 0.25)
        }
        .qishu8{background-color: rgba(253, 29, 62, 0.11)
        }
        .qishu9{background-color: rgba(237, 58, 218, 0.49)
        }
    </style>

</head>
<body>
<div class="layui-layout layui-layout-admin">

    <div id="view" style="padding:20px;">

        <p style="padding:10px 20px;"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop" style="color:red;">&#xe63d;</i> 加载中...</p>
    </div>

    <script id="select" type="text/html">
        <table class="layui-table" >

            <tr>

                <td colspan="20">
                    <div class="layui-form-item">
                        <form class="layui-form" onsubmit="return sousuo();">
                            <div class="layui-input-inline" style="width:88px;">
                                <input type="text" name="ROOMID" value="{{ ROOMID }}" id="ROOMID" placeholder="房间ID" autocomplete="off"  class="layui-input">
                            </div>
                            <div class="layui-input-inline" style="width:88px;">
                                <input type="text" name="SOID" value="{{ SOID }}" id="SOID" placeholder="用户uid" autocomplete="off"  class="layui-input">
                            </div>
                            <div class="layui-input-inline" style="width:88px;">
                                <input type="text" name="text" name="ETART" value="{{ ETART }}" id="ETART" placeholder="开始时间" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-input-inline" style="width:88px;">
                                <input type="text" name="text" name="JETART" value="{{ JETART }}" id="JETART" placeholder="结束时间" autocomplete="off" class="layui-input">
                            </div>

                            <button class="layui-btn layui-btn-normal" ><i class="layui-icon">&#xe615;</i> 立即搜索</button>

                            {{# if(TONGJIN != '0'){ }}

                            <button class="layui-btn layui-btn-danger" ><i class="layui-icon">&#xe62e;</i> {{ TONGJIN }}</button>

                            {{# } }}
                        </form>
                    </div>
                </td>

            </tr>

            <colgroup>

                {{# if( $(window).width() > 700){ }}

                <col>
                <col>
                <col>
                <col>
                <col>

                {{# } }}

                <col>
                <col>
                <col>

            </colgroup>

            <thead>

            <tr>
                {{# if( $(window).width() > 700){ }}
                <th>ID</th>
                <th>房间id</th>
                {{# } }}

                <th>用户ID</th>
                <th>下注金额</th>
                <th>输赢</th>
                <th>抽水</th>

                {{# if( $(window).width() > 700){ }}

                <th>牌池</th>
                <th>牌</th>
                <th>状态</th>
                <th>盲注</th>
                <th>盲注状态</th>
                <th>时间</th>

                {{# } }}

            </tr>

            </thead>
            <tbody>

            {{#  layui.each(d, function(index, item){ }}

            <tr id="tb{{ item.bet_id }}" class="qishu{{ item.bet_time.slice(-1) }}">

                {{# if( $(window).width() > 700){ }}
                <td>{{ item.bet_id }}</td>
                <td>{{ item.bet_roomid }}</td>
                {{# } }}

                <td>{{ item.bet_uid }}</td>
                <td>{{ item.bet_sum }}</td>
                <td>{{ item.bet_win }}</td>
                <td>{{ item.bet_rake }}</td>

                {{# if( $(window).width() > 700){ }}

                <td>{{ item.bet_chi }}</td>
                <td>{{ item.bet_pai }}</td>
                <td>{{ item.mang }}</td>
                <td>{{ item.bet_state }}</td>
                <td><span class="off{{ item.bet_mang == 1 ? 0:1 }}">{{ TYPE[item.bet_mang] }}</span></td>
                <td>{{ item.bet_time }}</td>

                {{# } }}

            </tr>

            {{# }); }}
            </tbody>
        </table>





    </script>
    <div class="baoqi" style="padding:0px 20px;">

        <div id="page" style="float:left;"></div>

    </div>

</div>


</body>
</html>
<script src="/layui/layui.js"></script>
<script src="/layui/lay/modules/jquery-3.2.1.min.js"></script>
<script src="/layui/lay/modules/webuploader.js"></script>

<script>
    var MODE = 'deBetlog';
    var NUM = 10;
    var pg = 1;
    var quanxin = Array();
    var ID = 0;
    var TYPE;
    var SOID = '';
    var ROOMID = '';
    var ETART = '';
    var JETART = '';
    var TONGJIN = 0;
    var page = 10000000;

    layui.config({
        base: '/layui/lay/modules/'
    });


    function sousuo(){

        SOID  = $("#SOID").val();
        ROOMID  = $("#ROOMID").val();
        ETART  = $("#ETART").val();
        JETART  = $("#JETART").val();

        pg =1;

        dbselect();
        return false;

    }


    /*开始时间*/
    $(document).on('click','#ETART',function () {

        laydate({
            elem: $('#ETART')[0], //需显示日期的元素选择器
            event: 'click', //触发事件
            format: 'YYYY-MM-DD', //日期格式
            istime: false, //是否开启时间选择
            isclear: true, //是否显示清空
            istoday: true, //是否显示今天
            issure: true, //是否显示确认
            festival: false, //是否显示节日
            min: '1900-01-01 00:00:00', //最小日期
            max: '2099-12-31 23:59:59', //最大日期
            fixed: true, //是否固定在可视区域
            zIndex: 99999999, //css z-index
        });
    });

    /*结束时间*/
    $(document).on('click','#JETART',function () {

        laydate({
            elem: $('#JETART')[0], //需显示日期的元素选择器
            event: 'click', //触发事件
            format: 'YYYY-MM-DD', //日期格式
            istime: false, //是否开启时间选择
            isclear: true, //是否显示清空
            istoday: true, //是否显示今天
            issure: true, //是否显示确认
            festival: false, //是否显示节日
            min: '1900-01-01 00:00:00', //最小日期
            max: '2099-12-31 23:59:59', //最大日期
            fixed: true, //是否固定在可视区域
            zIndex: 99999999, //css z-index
        });
    });

    function vwselect(data){

        laytpl = layui.laytpl;
        element = layui.element();
        form = layui.form();
        var tpl = document.getElementById('select').innerHTML;
        var render = laytpl(tpl).render(data.data);
        document.getElementById('view').innerHTML = render;
        element.init();

        form = layui.form();

        form.render('select');
    }


    function dbselect(){

        $.ajax({

            url:TXIN,
            type: "POST",
            data:{y:MODE,d:"get",ktime:ETART,jtime:JETART,tuid:SOID,room_id:ROOMID,num:NUM,pg:pg,apptoken:getCookie("apptoken")},
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){

                    TOKEN = data.token;
                }

                if(data.code == 1){

                    D = data.data;

                    layer.closeAll();

                    if(D.page){

                        page = D.page;

                    }

                    laypage({
                        cont:'page',
                        pages:page,
                        skip:true,
                        curr:pg,
                        jump:function(obj,first)
                        {
                            if(!first){
                                pg = obj.curr;
                                dbselect();
                            }
                        }
                    });

                    if(D.type){

                        TYPE = D.type;
                    }

                    if(D.jine){

                        TONGJIN = D.jine;

                    }else{

                        TONGJIN = 0;
                    }


                    vwselect(D);

                }else{

                    layer.msg('没有更多数据');
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });

    }

    var laypage;
    layui.use(['jquery','laytpl','laypage','layer','form', 'element','laydate'], function(){

        var layer = layui.layer,
                laydate =layui.laydate,
                upload =layui.upload,
                form = layui.form();
        $ = layui.jquery;
        var laytpl = layui.laytpl;
        laypage = layui.laypage;

        dbselect();

        laypage({
            cont:'page',
            pages:page,
            skip:false,
            jump:function(obj,first)
            {
                if(!first){
                    pg = obj.curr;
                    dbselect();
                }
            }
        });

    });

</script>



