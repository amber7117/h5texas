<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>管理后台</title>
<link rel="stylesheet" href="/layui/css/layui.css">
<link rel="stylesheet" href="/layui/lay/modules/webuploader.css">
<style>


.layui-input, .layui-textarea{width:80%;}
@media screen and (max-width: 450px){
.layui-form-item .layui-input-inline{margin-left:5px;}

}


</style>

</head>
<body>
<div class="layui-layout layui-layout-admin">

    <div id="view" style="padding:20px;">
    
    <form name="form" id="form" class="layui-form">



    </form>
    
  
    </div>

    



</div>



</body>
</html>
<script src="/layui/layui.js"></script>
<script src="/layui/lay/modules/jquery-3.2.1.min.js"></script>
<script src="/layui/lay/modules/webuploader.js"></script>

<script>
var NUM = 10;
var pg = 1;
var quanxin = Array();
var ID = 0;
var MODE = 'bjhtml';

var FUZHI = 1;

var XUZHONG = '';

layui.config({
  base: '/layui/lay/modules/'
});


function tijiao(cvcv){


    $neirong =  $(".mmmsss").val();

    $.ajax({

        url:TXIN,
        type: "POST",
        data:{y:MODE,d:"put",id:cvcv,nn:$neirong,apptoken:getCookie("apptoken")},
        dataType: "json",
        timeout:"3000",
        success: function(data){

            layer.msg('修改成功');

        },error:function(XMLHttpRequest){

            ajaxfan(XMLHttpRequest);
        }

    });


}

function duqu(cvcv){



    $.ajax({

            url:TXIN,
            type: "POST",
            data:{y:MODE,d:"get",id:cvcv,apptoken:getCookie("apptoken")},
            dataType: "json",
            timeout:"3000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){


                    
        html ='';
 

        $("#view").html('<textarea name="html" class="mmmsss" style="height:500px;width:90%">'+data.data.data+'</textarea><br /><button class="layui-btn" onclick="tijiao(\''+cvcv+'\');">确认更改</button>  <button class="layui-btn layui-btn-primary" onclick="dbselect();">返回</button>');




                }else{

                    layer.msg('没有更多数据');
                }


            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });



}



function add(data){


    D = data.data.data;

    if(D){

                html ='<form  style="padding:20px;"><select name="aihao" id="sname"  class="layui-btn layui-btn-danger" lay-filter="aihao">';

                html+= '<option value="">请选择要编辑的模版</option>';

                for(var m in D){

                    html+= '<option value="'+D[m]+'">'+D[m]+'</option>';
                }

                html+= '</select></form>';

                $("#view").html(html);
                $('#sname').change(function(){ 
                    duqu($(this).val());
                });
    }

}


function dbselect(){

    $(".baoqi").show();

    $.ajax({

        url:TXIN,
        type: "POST",
        data:{y:MODE,d:"get",num:NUM,pg:pg,apptoken:getCookie("apptoken")},
        dataType: "json",
        timeout:"3000",
        success: function(data){

            if(data.token && data.token != ""){
            
                TOKEN = data.token;
            }

            if(data.code == 1){


                add(data);

            }else{

                layer.msg('没有更多数据');
            }


        },error:function(XMLHttpRequest){

            ajaxfan(XMLHttpRequest);
        }

    });

}





layui.use(['jquery','laytpl','laypage','layer','form', 'element','laydate'], function(){


    var layer = layui.layer,
 
    laydate =layui.laydate,
    upload =layui.upload,
    form = layui.form();
    $ = layui.jquery;
    var laytpl = layui.laytpl;

    dbselect();


});

</script>



