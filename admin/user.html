<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>管理后台</title>
<link rel="stylesheet" href="/layui/css/layui.css">
<link rel="stylesheet" href="/layui/lay/modules/webuploader.css">
<style>
.layui-form{padding-top:10px;}
</style>

</head>
<body>
<div class="layui-layout layui-layout-admin">

    <div id="view" style="padding:20px;"> 
    
        <p style="padding:10px 20px;"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop" style="color:red;">&#xe63d;</i> 加载中...</p>
    </div>

    <script id="select" type="text/html">
    <table class="layui-table" >

     <tr>

        <td colspan="30">
        <div class="layui-form-item">
        <form class="layui-form" onsubmit="return sousuo();">
            <div class="layui-input-inline">
                <select name="SOl" id="SOl">
                    <option value="-1" selected="selected">选择全部</option>

                    {{# layui.each(LEVEL, function(index, item){ }}
                         <option value="{{ index }}" {{ SOl == index ?' selected="selected" ':''}} >{{ item }}</option>
                    {{# }); }}

                </select>
            </div>
            <div class="layui-input-inline" style="width:88px;">
                <input type="text" name="SOID" value="{{ SOID }}" id="SOID" placeholder="代理UID" autocomplete="off"  class="layui-input">
            </div> 
            <div class="layui-input-inline" style="width:88px;">
                <input type="text" name="text" name="SOSO" value="{{ SOSO }}" id="SOSO"  placeholder="UID" autocomplete="off" class="layui-input">
            </div> 
            <div class="layui-input-inline" style="width:88px;">
                <input type="text" name="text" name="NAME" value="{{ NAME }}" id="NAME"  placeholder="昵称" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width:88px;">
                <input type="text" name="text" name="ETART" value="{{ ETART }}" id="ETART" placeholder="开始时间" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width:88px;">
                <input type="text" name="text" name="JETART" value="{{ JETART }}" id="JETART" placeholder="结束时间" autocomplete="off" class="layui-input">
            </div>

            <button class="layui-btn layui-btn-normal" ><i class="layui-icon">&#xe615;</i> 立即搜索</button>
            </form>
         </div>
        </td>
     
     </tr>

      <colgroup>
       {{# if( $(window).width() > 700){ }}
        <col width="80">
        
        <col>
       
        <col width="150">
        <col width="200">

        {{# } }}
        
        <col>
        <col>
         
      </colgroup>
  <thead>
    <tr>
    {{# if( $(window).width() > 700){ }}
     <th>ID</th>

          {{# } }}
      <th>昵称</th>
      {{# if( $(window).width() > 700){ }}
      <th>登陆账号</th>
      <th>状态</th>
      <th>上级ID</th>
      <th>上级昵称</th>

      <th>2级</th>
      <th>3级</th>
      <th>4级</th>
      <th>5级</th>
      <th>6级</th>
      <th>7级</th>
      <th>8级</th>
      <th>9级</th>
      <th>10级</th>

      <th>金币</th>
      <th>佣金</th>
      <th>积分</th>
      <th>注册ip</th>
      <th>注册时间</th>
      {{# } }}

      <th>操作</th>
    </tr> 
  </thead>
<tbody>
  {{#  layui.each(d, function(index, item){ }}
  
    <tr id="tb{{ item.uid }}">

    {{# if( $(window).width() > 700){ }}
    <td>{{ item.uid }}</td>
      {{# } }}
      <td>{{ item.name }}</td>
      {{# if( $(window).width() > 700){ }}

        <td>{{ item.zhanghao }}</td>
        <td><span class="off{{ item.off }}">{{ OFF[item.off] }}</span></td>
        <td>{{ item.tuid }}</td>
        <td>{{ item.tname }}</td>

        <td>{{ item.tuid1 }}</td>
        <td>{{ item.tuid2 }}</td>
        <td>{{ item.tuid3 }}</td>
        <td>{{ item.tuid4 }}</td>
        <td>{{ item.tuid5 }}</td>
        <td>{{ item.tuid6 }}</td>
        <td>{{ item.tuid7 }}</td>
        <td>{{ item.tuid8 }}</td>
        <td>{{ item.tuid9 }}</td>

        <td>{{ item.huobi }}</td>
        <td>{{ item.yongjin }}</td>
        <td>{{ item.integral }}</td>
        <td>{{ item.ip }}</td>
        <td>{{ time(item.atime) }}</td>
       
      {{# } }}


    
      <td>
      <button class="layui-btn" onclick="edit({{ item.uid }});"><i class="layui-icon">&#xe642;</i> 编辑</button>

      <button class="layui-btn layui-btn-danger  layui-btn-small" onclick="dbdel({{ item.uid }});"><i class="layui-icon">&#xe640;</i> 删除</button>

      </td>

    </tr>
    {{# }); }}
  
  </tbody>
</table>


    


    </script>
    <div class="baoqi" style="padding:0px 20px;">

        <button class="layui-btn layui-btn-normal  layui-btn-small" onclick="add();" style="float:left;margin-right:18px;margin-top:10px;"><i class="layui-icon">&#xe654;</i> 新建 </button>
        <div id="page" style="float:left;"></div>

    </div>

</div>


</body>
</html>
<script src="/layui/layui.js"></script>
<script src="/layui/lay/modules/jquery-3.2.1.min.js"></script>
<script src="/layui/lay/modules/webuploader.js"></script>

<script>
var MODE = 'user';
var NUM = 10;
var pg = 1;
var quanxin = Array();
var ID = 0;
var LEVEL;
var OFF;
var YIP;
var XINGBIE;
var JINE;
var TUIYX = Array('无效','有效');
var SOl = -1;
var SOID = '';
var SOSO = '';
var NAME = '';
var ETART = '';
var JETART = '';
var TONGJIN = 0;
var page = 10000000;

layui.config({
  base: '/layui/lay/modules/'
});


function sousuo(){

    SOl  = $("#SOl").val();
    SOID  = $("#SOID").val();
    SOSO  = $("#SOSO").val();
    NAME  = $("#NAME").val();
    ETART  = $("#ETART").val();
    JETART  = $("#JETART").val();
    pg =1;

    dbselect();
    return false;
}

/*开始时间*/
$(document).on('click','#ETART',function () {

    laydate({
        elem: $('#ETART')[0], //需显示日期的元素选择器
        event: 'click', //触发事件
        format: 'YYYY-MM-DD', //日期格式
        istime: false, //是否开启时间选择
        isclear: true, //是否显示清空
        istoday: true, //是否显示今天
        issure: true, //是否显示确认
        festival: false, //是否显示节日
        min: '1900-01-01 00:00:00', //最小日期
        max: '2099-12-31 23:59:59', //最大日期
        fixed: true, //是否固定在可视区域
        zIndex: 99999999, //css z-index
    });
});

/*结束时间*/
$(document).on('click','#JETART',function () {

    laydate({
        elem: $('#JETART')[0], //需显示日期的元素选择器
        event: 'click', //触发事件
        format: 'YYYY-MM-DD', //日期格式
        istime: false, //是否开启时间选择
        isclear: true, //是否显示清空
        istoday: true, //是否显示今天
        issure: true, //是否显示确认
        festival: false, //是否显示节日
        min: '1900-01-01 00:00:00', //最小日期
        max: '2099-12-31 23:59:59', //最大日期
        fixed: true, //是否固定在可视区域
        zIndex: 99999999, //css z-index
    });
});

function dbdel(ID){

    /*删除数据*/

    layer.confirm('确定删除?', {icon: 3, title:'提示'}, function(index){

        $.ajax({

            url:TXIN,
            type: "POST",
            data:{y:MODE,d:"delete",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")},
            dataType: "json",
            timeout:"6000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){

                    $("#tb"+ID).remove();
                    layer.close(index);
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }
        });
    });
}


function edit(ID){

    html ='<form name="form" id="form" class="layui-form">';
    BIAO = Array(

        'name#用户昵称#text##用户昵称##required',
        'off#状态#select##OFF',
        'xingbie#性别#select##XINGBIE',
        'touxiang#头像#update##头像##',
        'level#用户等级#select##LEVEL',
        'tuid#代理ID#text##',
        'appid#推广有效#select##TUIYX',
        'zhiye#佣金姓名#text##',
        'qqhaoma#佣金方式#text##',
        'weixinhaoma#佣金帐号#text##',
        'zhanghao#登陆账号#text##登陆账号##',
        'email#登陆邮箱#text##登陆邮箱##',
        'shouji#登陆手机#text##登陆手机##',
        'mima#登录密码#password##登录密码##',
        'ermima#超级密码#password##登录密码##',
        'weixin#微信登陆#text##微信openid##',
        'weixinui#微信u登陆#text##微信uopenid##',
        'weibo#微博登陆#text##weibo##',
        'qqopen#QQ快捷登陆#text##qq快捷登陆##',
        'zhifubaoopen#支付宝登陆#text##支付宝登陆##',
        'openid#微信开放#text##微信开放openid##',
        'openidd#备用开放#text##备用开放可填写其他信息##',
        
        'jine#'+JINE.jine+'#text####',
        'jifen#'+JINE.jifen+'#text####',
        'huobi#'+JINE.huobi+'#text####',
        'yongjin#'+JINE.yongjin+'#text####',
        'integral#'+JINE.integral+'#text####',

        'yanzhengip#验证IP#select##YIP',
        'ip#IP#text##',
        'atime#注册时间#text##',
      
        'qdtime#签到时间#text##',
        
       



        'tijiao##tjcz###立即修改#tijiao'
    );

    for(var z in BIAO){

        html+=jsfrom(BIAO[z]);
    }

    html+="</form>";

    OPID = layer.open({
        type: 1,
        title:false,
        area: ['100%', '100%'],
        fixed: true, 
        maxmin: false,
        content: html
    });


    $.ajax({

        url:TXIN,
        type: "POST",
        data:{y:MODE,d:"get",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")},
        dataType: "json",
        timeout:"6000",
        success: function(data){

            if(data.token && data.token != ""){
            
                TOKEN = data.token;
            }

            if(data.code == 1){

                D = data.data;

                for(var H in D){

                    if(H =='atime' || H == 'qdtime'){

                        $("[name="+H+"]").val( time(D[H]) );
                    
                    
                    }else{

                        $("[name="+H+"]").val(D[H]);
                    }

                    
                
                }
                form = layui.form();
                form.render();
                
            }

        },error:function(XMLHttpRequest){

            ajaxfan(XMLHttpRequest);
        }

    });

    form = layui.form();

    form.on('submit(tijiao)', function(data){
 
        dd = {y:MODE,d:"put",id:ID,ttoken:TOKEN,apptoken:getCookie("apptoken")};
        obj = $.extend(dd,data.field);

        $.ajax({

            url:TXIN,
            type: "POST",
            data:obj,
            dataType: "json",
            timeout:"6000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){

                    layer.close(OPID);
                    dbselect();
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });

        return false;
    });
    form.render();
}

function add(ID){

    /*新建数据*/

    html ='<form name="form" id="form" class="layui-form">';
    BIAO = Array(
        'name#用户昵称#text##用户昵称##required',
        'xingbie#性别#select##XINGBIE',
        'touxiang#头像#update##头像##',
        'level#用户等级#select##LEVEL',
        'tuid#代理ID#text##',
        'appid#推广有效#select##TUIYX',
          'zhiye#佣金姓名#text##',
        'qqhaoma#佣金方式#text##',
        'weixinhaoma#佣金帐号#text##',
        'zhanghao#登陆账号#text##登陆账号##',
        'email#登陆邮箱#text##登陆邮箱##',
        'shouji#登陆手机#text##登陆手机##',
        'mima#登录密码#password##登录密码##',
        'ermima#超级密码#password##登录密码##',
        'weixin#微信登陆#text##微信openid##',
        'weixinui#微信u登陆#text##微信uopenid##',
        'weibo#微博登陆#text##weibo##',
        'qqopen#QQ快捷登陆#text##qq快捷登陆##',
        'zhifubaoopen#支付宝登陆#text##支付宝登陆##',
        'openid#微信开放#text##微信开放openid##',
        'openidd#备用开房#text##备用开房##',
        'jine#'+JINE.jine+'#text####',
        'jifen#'+JINE.jifen+'#text####',
        'huobi#'+JINE.huobi+'#text####',
        'yongjin#'+JINE.yongjin+'#text####',
            'integral#'+JINE.integral+'#text####',

        'off#状态#select##OFF',
        'yanzhengip#验证IP#select##YIP',
        'ip#IP#text##',
        'atime#注册时间#text##',
      
        'qdtime#签到时间#text##',
        'tijiao##tjcz###立即注册#tijiao'
    );

    for(var z in BIAO){

        html+=jsfrom(BIAO[z]);
    
    }

    html+="</form>";

    OPID = layer.open({
        type: 1,
        title:false,
        area: ['100%', '100%'],
        fixed: true, 
        maxmin: false,
        content: html
    });

    form = layui.form();

    form.on('submit(tijiao)', function(data){

        dd = {y:MODE,d:"post",ttoken:TOKEN,apptoken:getCookie("apptoken")};
        obj =$.extend(dd,data.field);

        $.ajax({

            url:TXIN,
            type: "POST",
            data:obj,
            dataType: "json",
            timeout:"6000",
            success: function(data){

                if(data.token && data.token != ""){
                
                    TOKEN = data.token;
                }

                if(data.code == 1){


                    
                    layer.close(OPID);
                    dbselect();
                }

            },error:function(XMLHttpRequest){

                ajaxfan(XMLHttpRequest);
            }

        });

        return false;
    });

    form.render();
}



function vwselect(data){

    laytpl = layui.laytpl;
    element = layui.element();
    form = layui.form();
    var tpl = document.getElementById('select').innerHTML;
    var render = laytpl(tpl).render(data.data);
    document.getElementById('view').innerHTML = render;
    element.init();

  

    form = layui.form();
  
    form.render('select'); 
    
 
}


function dbselect(){

    $.ajax({

        url:TXIN,
        type: "POST",
        data:{y:MODE,d:"get",ktime:ETART,jtime:JETART,level:SOl,tuid:SOID,soso:SOSO,name:NAME,num:NUM,pg:pg,apptoken:getCookie("apptoken")},
        dataType: "json",
        timeout:"6000",
        success: function(data){

            if(data.token && data.token != ""){
            
                TOKEN = data.token;
            }

            if(data.code == 1){

                D = data.data;

                layer.closeAll();

                //页数
                if(D.page){

                    page = D.page;

                    //更新分页
                    laypage({
                        cont:'page',
                        pages:page,
                        skip:true,
                        curr:pg,
                        jump:function(obj,first)
                        {
                            if(!first){
                                pg = obj.curr;
                                dbselect();
                            }
                        }
                    });
                }

                if(D.jine){

                    JINE = D.jine;
                }
        
                if(D.level){

                    LEVEL = D.level;
                }

                if(D.xingbie){

                    XINGBIE = D.xingbie;
                    XINGBIE[-1]="未选择";
                }
                if(D.off){

                    OFF = D.off;
                }

                if(D.yip){

                    YIP = D.yip;
                }
                vwselect(D);

            }else{

                layer.msg('没有更多数据');
            }

        },error:function(XMLHttpRequest){

            ajaxfan(XMLHttpRequest);
        }

    });
}

var laypage;
layui.use(['jquery','laytpl','laypage','layer','form', 'element','laydate'], function(){

    var layer = layui.layer,
    laydate =layui.laydate,
    upload =layui.upload,
    form = layui.form();
    $ = layui.jquery;
    var laytpl = layui.laytpl;
    laypage = layui.laypage;

    dbselect();
    laypage({
        cont:'page',
        pages:page,
        skip:true,
        jump:function(obj,first)
        {
            if(!first){
                pg = obj.curr;
                dbselect();
            }
        }
    });

});

</script>



